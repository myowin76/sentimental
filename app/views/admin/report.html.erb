<header>
    <h1>Client Sentiment Pulse Report</h1>
    <p>Pick the date range you want to examine the sentiment pulse for and then optionally filter the data on campaign name, target word and use the sentiment value slider to set the maximum sentiment value.</p>
</header>
<div class="filter row">
	<%= form_tag admin_report_path, :method => 'get' do %>
  <div class="col-sm-2">
    <%= text_field_tag :search, params[:text], id: 'date_from', placeholder: 'Date From', class: 'form-control datepicker-input' %>
  </div>
  <div class="col-sm-2">
    <%= text_field_tag :search, params[:text], id: 'date_to', placeholder: 'Date To', class: 'form-control datepicker-input' %>
  </div>
  <div class="col-sm-3">
  	<%= select("survey", "survey_id", @surveys.collect {|p| [ p.name, p.id ] }, {}, {class: 'form-control '}) %>
  </div>
  <div class="col-sm-3">
    <%= text_field_tag :search, params[:text], placeholder: 'Target word', class: 'form-control' %>
  </div>
  <div class="col-sm-2">
    <%= submit_tag "Update", :name => nil, class: 'btn btn-default' %>
  </div>
<% end %>
	
</div>
<div id="chartdiv" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<% content_for :scripts do %>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<script type="text/javascript" src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<script type="text/javascript" src="https://www.amcharts.com/lib/3/serial.js"></script>
<script type="text/javascript" src="https://www.amcharts.com/lib/3/themes/none.js"></script>
<div id="chartdiv"></div>                       
<script type="text/javascript">
$(function () {
    $( "#date_from" ).datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 2,
      onClose: function( selectedDate ) {
        $( "#date_to" ).datepicker( "option", "minDate", selectedDate );
      }
    });
    $( "#date_to" ).datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 2,
      onClose: function( selectedDate ) {
        $( "#date_from" ).datepicker( "option", "maxDate", selectedDate );
      }
    });


  var chart = AmCharts.makeChart("chartdiv", {
    "type": "serial",
    "theme": "none",
    "marginLeft": 20,
    "pathToImages": "http://www.amcharts.com/lib/3/images/",
    "dataProvider": <%= raw(@surveys.last.client_surveys.order(:created_at).to_json(:only => [:created_at, :score, :text])) %>,
    "valueAxes": [{
        "axisAlpha": 0,
        "inside": true,
        "position": "left",
        "ignoreAxisWidth": true
    }],
    "graphs": [{
        "balloonText": "[[category]]<br><b><span style='font-size:14px;'>[[text]]</span></b>",
        "bullet": "round",
        "bulletSize": 6,
        "lineColor": "#d1655d",
        "lineThickness": 1,
        "negativeLineColor": "#637bb6",
        "type": "smoothedLine",
        "valueField": "score"
    }],
    "chartScrollbar": {},
    "chartCursor": {
        "categoryBalloonDateFormat": "YYYY",
        "cursorAlpha": 0,
        "cursorPosition": "mouse"
    },
    "dataDateFormat": "YYYY",
    "categoryField": "created_at",
    "categoryAxis": {
        "minPeriod": "YYYY",
        "parseDates": true,
        "minorGridAlpha": 0.1,
        "minorGridEnabled": true
    }
});
});
</script>	


<% end %>
